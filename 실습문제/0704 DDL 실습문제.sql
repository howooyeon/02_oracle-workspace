--실습문제--
--도서관리 프로그램을 만들기 위한 테이블을 만들기
--이때, 제약조건에 이름을 부여할 것
-- 각 컬럼에 주석달기

CREATE TABLE TB_PUBLISHER(
 PUB_NO NUMBER CONSTRAINT TB_PUBLISHER PRIMARY KEY,
 PUB_NAME VARCHAR2(20) NOT NULL,
 PHONE VARCHAR2(14)
);

SELECT * FROM TB_PUBLISHER;

INSERT INTO TB_PUBLISHER VALUES (213, '뫄뫄출판사', '02-3333-4444');
INSERT INTO TB_PUBLISHER VALUES (214, '오잉출판사', '02-4444-5555');
INSERT INTO TB_PUBLISHER VALUES (215, '에엥출판사', '02-6666-7777');

DROP TABLE TB_BOOK;
DROP TABLE TB_PUBLISHER;

--2. 도서들에 대한 데이터를 담기 위한 도서 테이블(TB_BOOK)
CREATE TABLE TB_BOOK (
    BK_NO NUMBER CONSTRAINT BOOK_PK PRIMARY KEY,
    BK_TITLE VARCHAR2(50) CONSTRAINT BOOK_NN_TITLE NOT NULL,
    BK_AUTHOR VARCHAR2(20) CONSTRAINT BOOK_NN_AUTHOR NOT NULL,
    BK_PRICE NUMBER,
    BK_STOCK NUMBER DEFAULT 1,
    BK_PUB_NO NUMBER REFERENCES TB_PUBLISHER
);

COMMENT ON COLUMN TB_BOOK.BK_NO IS '도서번호';
COMMENT ON COLUMN TB_BOOK.BK_TITLE IS '도서명';
COMMENT ON COLUMN TB_BOOK.BK_AUTHOR IS '저자명';
COMMENT ON COLUMN TB_BOOK.BK_PRICE IS '가격';
COMMENT ON COLUMN TB_BOOK.BK_STOCK IS '재고';
COMMENT ON COLUMN TB_BOOK.BK_PUB_NO IS '출판사번호';

--5개 정도의 샘플 데이터 추가하기
INSERT INTO TB_BOOK VALUES (1, '제목은 뭐로하지?', '엉드레 버나드', 12000, 20, 213);
INSERT INTO TB_BOOK VALUES (2, '실어증입니다. 일하기 싫어증', '양경수', 15000, 182, 214);
INSERT INTO TB_BOOK VALUES (3, '오은영의 마음수호대', '오은영', 13000, 21, 214);
INSERT INTO TB_BOOK VALUES (4, '도둑맞은 집중력', '요한하리', 18800, 54, 215);
INSERT INTO TB_BOOK VALUES (5, '최선을 다하면 죽는다', '황선우', 13000, 33, 215);

SELECT * FROM TB_BOOK;

DROP TABLE TB_MEMBER;

--3. 회원에 대한 데이터를 담기 위한 회원 테이블(TB_MEMBER)
CREATE TABLE TB_MEMBER(
 MEMBER_NO NUMBER CONSTRAINT MEMBER_PK PRIMARY KEY,
 MEMBER_ID VARCHAR2(20) CONSTRAINT MEMBER_UQ UNIQUE,
 MEMBER_PWD VARCHAR2(20) CONSTRAINT MEMBER_NN_PWD NOT NULL,
 MEMBER_NAME VARCHAR2(20) CONSTRAINT MEMBER_NN_NAME NOT NULL,
 GENDER CHAR(1) CONSTRAINT MEMBER_CK_GEN CHECK (GENDER IN ('M', 'F')),
 ADDRESS VARCHAR2(60),
 PHONE VARCHAR2(16),
 STATUS CHAR(1) DEFAULT 'N' CONSTRAINT MEMBER_CK_STA CHECK (STATUS IN('Y', 'N')),
 ENROLL_DATE DATE DEFAULT SYSDATE CONSTRAINT MEMBER_NN_EN NOT NULL
);

SELECT * FROM TB_MEMBER;

COMMENT ON COLUMN TB_MEMBER.MEMBER_NO IS '회원번호';
COMMENT ON COLUMN TB_MEMBER.MEMBER_ID IS '아이디';
COMMENT ON COLUMN TB_MEMBER.MEMBER_PWD IS '비밀번호';
COMMENT ON COLUMN TB_MEMBER.MEMBER_NAME IS '회원명';
COMMENT ON COLUMN TB_MEMBER.GENDER IS '성별';
COMMENT ON COLUMN TB_MEMBER.ADDRESS IS '주소';
COMMENT ON COLUMN TB_MEMBER.PHONE IS '연락처';
COMMENT ON COLUMN TB_MEMBER.STATUS IS '탈퇴여부';
COMMENT ON COLUMN TB_MEMBER.ENROLL_DATE IS '가입일';

--5개 정도의 샘플 데이터 추가하기
INSERT INTO TB_MEMBER
VALUES(6, 'user01', 'pass01', '이준혁', 'M', '서울특별시 강남구 테헤란로 14길 6', '010-2123-0854', DEFAULT, DEFAULT);

INSERT INTO TB_MEMBER
VALUES(7, 'user02', 'pass02', '안효섭', 'M', '강원도 원주시 호저면 대덕리 돌담병원', '010-3232-4343', 'Y', '2021/07/17');

INSERT INTO TB_MEMBER
VALUES(8, 'user03', 'pass03', '안유진', 'F', '대전광역시 서구 둔산동', '010-1234-9774', DEFAULT, '23/02/08');

INSERT INTO TB_MEMBER
VALUES(9, 'user04', 'pass04', '서강준', 'M', '서울특별시 강남구 대치동 32길 85로', '010-5784-9449', 'Y', '99/08/01');

INSERT INTO TB_MEMBER
VALUES(10, 'user05', 'pass05', '이성경', 'F', '경기도 포천시 영북면 산정호수로', '010-0101-0101', DEFAULT, DEFAULT);

CREATE TABLE TB_RENT(
    RENT_NO NUMBER CONSTRAINT RENT_PK PRIMARY KEY,
    RENT_MEM_NO NUMBER CONSTRAINT RENT_FK_MEM REFERENCES TB_MEMBER ON DELETE SET NULL,
    RENT_BOOK_NO NUMBER CONSTRAINT RENT_FK_BOOK REFERENCES TB_BOOK ON DELETE SET NULL,
    RENT_DATE DATE DEFAULT SYSDATE
);

SELECT * FROM TB_RENT;

COMMENT ON COLUMN TB_RENT.RENT_NO IS '대여번호';
COMMENT ON COLUMN TB_RENT.RENT_MEM_NO IS '대여회원번호';
COMMENT ON COLUMN TB_RENT.RENT_BOOK_NO IS '대여도서번호';
COMMENT ON COLUMN TB_RENT.RENT_DATE IS '대여일';

INSERT INTO TB_RENT
VALUES(23, 7, 2, DEFAULT);

INSERT INTO TB_RENT
VALUES(24, 6, 1, DEFAULT);

INSERT INTO TB_RENT
VALUES(25, 10, 3, DEFAULT);

-- 12번 도서를 대여한 회원의 이름, 아이디, 대여일, 반납예정일(대여일+7)을 조회하시오.
-- 방법1.
SELECT MEMBER_NAME AS "회원명", MEMBER_ID AS "아이디", RENT_DATE AS "대여일", RENT_DATE + 7 AS "반납예정일"
FROM TB_MEMBER, TB_RENT
WHERE MEMBER_NO = RENT_MEM_NO
AND RENT_BOOK_NO = 2;

